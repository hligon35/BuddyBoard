BuddyBoard — Pre‑Production / App Store & Play Store Checklist
Date: 2025-12-17
Branch: test

This checklist is tailored to this repo’s current setup:
- Expo SDK 54 / EAS Build
- Location + reverse geocode (expo-location)
- Google Places autocomplete (Places API v1 + legacy fallback)
- Expo push notifications (expo-notifications) + mock backend endpoints
- Docker compose services for dev + api-mock

============================================================
CRITICAL (Do before any production submission)
============================================================

1) Secrets & API Keys (must not be committed)
- Confirm no hard-coded keys in repo:
  - Google Places key must be provided via EXPO_PUBLIC_GOOGLE_PLACES_API_KEY (NOT committed in src/config.js).
  - Ensure google-play-service-account.json and appstore_connect.json are not committed to public repos.
- Add/verify .gitignore includes:
  - *.key, *.p8, *.mobileprovision, *.keystore
  - google-play-service-account.json, appstore_connect.json
  - .env, .env.* (if you use env files)
- On the build server, set environment variables via EAS Secrets or CI secrets:
  - EXPO_PUBLIC_GOOGLE_PLACES_API_KEY
  - Any production BASE_URL / API base

2) Backend endpoints must be real (api-mock is NOT production)
- Decide the production API base URL and set it without code edits:
  - Prefer environment-driven config rather than hardcoding BASE_URL in src/config.js.
- Ensure the real backend provides and returns correct JSON for:
  - /api/health
  - /api/board, /api/messages, /api/urgent-memos, /api/children/time-change-proposals
  - /api/push/register and /api/push/unregister (store tokens + preferences)
- Confirm auth/security:
  - Push endpoints should require auth (or use a service token) so anyone cannot register arbitrary tokens.
  - Rate limit push-related endpoints.

3) Push Notifications (App Store / TestFlight readiness)
- Understand the runtime constraints:
  - Expo Go has limitations for expo-notifications; production validation must be on a Development Build or TestFlight build.
- Verify Expo push token flow on a physical iOS device:
  - Enable Push Notifications in Settings
  - Confirm a token is stored (AsyncStorage key push_expo_token_v1)
  - Confirm backend receives: { token, platform, userId, enabled, preferences }
- Confirm your EAS projectId exists and matches app.json extra.eas.projectId:
  - app.json: expo.extra.eas.projectId
- Confirm notification behavior:
  - Decide whether sound/badge are required; current handler shows alerts only.

4) Permissions & Store Compliance
- iOS:
  - Ensure Info.plist usage strings are present for Location (since expo-location prompts users).
  - If you use image picker/media, ensure required iOS permissions are set (photos/camera).
- Android:
  - Ensure runtime permissions for notifications (Android 13+) are handled by expo-notifications.
  - Ensure location permission flows are correct.
- Privacy:
  - Prepare a Privacy Policy URL and ensure it matches your actual data collection.
  - Prepare App Store “Privacy Nutrition Labels” answers (location, identifiers, diagnostics, etc.).

5) Release Versioning (must be consistent)
- app.json:
  - iOS: buildNumber must increment every upload to App Store Connect.
  - Android: versionCode must increment every upload to Play Console.
  - expo.version should match your marketing versioning plan.

6) Build Profiles & Testing Builds
- Build a Development Client for device testing (push notifications especially):
  - eas build --profile development -p ios / android
- Build a Production candidate for store submission:
  - eas build --profile production -p ios / android
- Run sanity checks:
  - App launches, login works, core screens render
  - No redbox errors

7) Google Places API (Autocomplete) Production Hardening
- Ensure billing is enabled for the Google project.
- Ensure API restrictions are correct:
  - Allow Places API (v1) and/or legacy endpoints used.
  - Restrict by iOS bundle id: com.azlabs.buddyboard
  - Restrict by Android package name: com.azlabs.buddyboard + SHA-1 (if you plan to use Android-restricted keys)
- Confirm error surfacing is acceptable:
  - Current UI surfaces error text; ensure this is user-friendly for production.

8) Data Integrity Checks (critical app behaviors)
- Arrival controls save format (AsyncStorage business_address_v1):
  - Must be JSON: { address: string, lat: number, lng: number, dropZoneMiles: number }
  - Confirm lat/lng are finite numbers before saving.
- Push settings save format:
  - Preferences object keys: chats, timelinePosts, mentionsPosts, tagsPosts, repliesComments, mentionsComments, updates, other
  - Confirm backend expects same names/types.

============================================================
RECOMMENDED (Strongly advised before store submission)
============================================================

9) Environment-driven BASE_URL (avoid hardcoding)
- Move BASE_URL to environment config so the same code can target:
  - dev (local/mock), staging, production
- Recommendation:
  - Use EXPO_PUBLIC_API_BASE_URL and read it in src/config.js.

10) Crash Reporting & Observability
- Add crash reporting (e.g., Sentry) for release builds.
- Add server-side logging for push registration and send attempts.

11) Performance / UX
- Confirm keyboard avoidance works on both iOS + Android for Admin Arrival Controls.
- Confirm address autocomplete doesn’t spam requests (debounce) and doesn’t flicker on selection.
- Confirm scroll performance and large list rendering.

12) Security Hardening
- Use HTTPS in production for BASE_URL.
- Add request authentication/authorization checks for all sensitive endpoints.
- Validate input types server-side (lat/lng ranges, dropZoneMiles > 0, token format).

13) Store Assets
- iOS:
  - App Store screenshots (all required device sizes), app icon (1024), description, keywords
- Android:
  - Feature graphic, screenshots, privacy policy URL

14) Build Server / Docker Readiness
- If building on a server with Docker:
  - Ensure container installs dependencies before running Expo (compose already does this).
  - Ensure Node version matches Expo SDK expectations (Node 18+ recommended).
- Ensure secrets are injected via CI/host environment, not baked into images.

15) E2E Push Test Playbook (recommended)
- On device:
  1) Install dev build/TestFlight build
  2) Enable Push Notifications toggle
  3) Verify backend /api/push/tokens contains your token + preferences
  4) Trigger a test push from backend
  5) Verify receipt/status from Expo push service and confirm notification arrives

============================================================
FINAL PRE-SUBMISSION QUICK CHECK (10 minutes)
============================================================
- Increment iOS buildNumber + Android versionCode
- Confirm production BASE_URL points to production API
- Confirm EXPO_PUBLIC_GOOGLE_PLACES_API_KEY is set in EAS/CI secrets
- Confirm login + basic navigation works
- Confirm location permission flow works
- Confirm push token registration succeeds on physical device build
- Confirm no debug-only flags or dev endpoints are enabled for production
